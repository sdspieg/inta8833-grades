<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTA 8833 - Grade Distribution (Post-Curve)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    padding: 2rem;
    line-height: 1.6;
  }
  h1 {
    text-align: center;
    font-size: 1.8rem;
    font-weight: 300;
    letter-spacing: 0.05em;
    margin-bottom: 0.3rem;
    color: #f8fafc;
  }
  .subtitle {
    text-align: center;
    color: #94a3b8;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  .curve-note {
    text-align: center;
    color: #34d399;
    font-size: 0.8rem;
    margin-bottom: 2rem;
    font-style: italic;
  }
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
  }
  .card {
    background: #1e293b;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #334155;
  }
  .card.full { grid-column: 1 / -1; }
  .card h2 {
    font-size: 1rem;
    font-weight: 600;
    color: #cbd5e1;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: 0.8rem;
  }
  .chart-container {
    position: relative;
    height: 300px;
  }
  .chart-container.tall {
    height: 380px;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }
  .stats-grid.six {
    grid-template-columns: repeat(6, 1fr);
  }
  .stat-box {
    background: #0f172a;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
  }
  .stat-box .label {
    font-size: 0.7rem;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.3rem;
  }
  .stat-box .value {
    font-size: 1.6rem;
    font-weight: 700;
  }
  .stat-box .detail {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.2rem;
  }
  .rr1 { color: #60a5fa; }
  .rr2 { color: #f472b6; }
  .boost { color: #34d399; }
  .base-col { color: #94a3b8; }
  .warn { color: #fbbf24; }

  .legend-row {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.8rem;
    color: #94a3b8;
  }
  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 3px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }
  th {
    text-align: left;
    padding: 0.6rem 0.8rem;
    border-bottom: 2px solid #334155;
    color: #94a3b8;
    font-weight: 600;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  td {
    padding: 0.5rem 0.8rem;
    border-bottom: 1px solid #1e293b;
  }
  tr:nth-child(even) td { background: #0f172a22; }
  .num { text-align: right; font-variant-numeric: tabular-nums; }
  .highlight { color: #34d399; font-weight: 600; }

  @media (max-width: 800px) {
    .grid { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .stats-grid.six { grid-template-columns: repeat(3, 1fr); }
    body { padding: 1rem; }
  }
</style>
</head>
<body>

<h1>INTA 8833 European Security</h1>
<p class="subtitle">Reading Reflections 1 & 2 &mdash; Grade Distribution (Anonymous) &mdash; Spring 2026</p>
<p class="curve-note">+10 calibration curve applied &bull; Floor of 60 for submitted work &bull; Bonuses folded in</p>

<div class="legend-row">
  <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div> RR1 Pre-Curve</div>
  <div class="legend-item"><div class="legend-dot" style="background:#60a5fa"></div> RR1 Post-Curve</div>
  <div class="legend-item"><div class="legend-dot" style="background:#be185d"></div> RR2 Pre-Curve</div>
  <div class="legend-item"><div class="legend-dot" style="background:#f472b6"></div> RR2 Post-Curve</div>
</div>

<div class="grid">

  <!-- Summary Stats -->
  <div class="card full">
    <h2>Summary Statistics</h2>
    <div class="stats-grid six">
      <div class="stat-box">
        <div class="label">RR1 Pre-Curve</div>
        <div class="value base-col">77.2</div>
      </div>
      <div class="stat-box">
        <div class="label">RR1 Post-Curve</div>
        <div class="value rr1">86.5</div>
        <div class="detail boost">+9.3</div>
      </div>
      <div class="stat-box">
        <div class="label">RR2 Pre-Curve</div>
        <div class="value base-col">69.0</div>
      </div>
      <div class="stat-box">
        <div class="label">RR2 Post-Curve</div>
        <div class="value rr2">79.7</div>
        <div class="detail boost">+10.7</div>
      </div>
      <div class="stat-box">
        <div class="label">D/F Before</div>
        <div class="value warn">4</div>
        <div class="detail">all on RR2</div>
      </div>
      <div class="stat-box">
        <div class="label">D/F After</div>
        <div class="value boost">0</div>
        <div class="detail">floor = 60</div>
      </div>
    </div>
  </div>

  <!-- Grade Distribution Bar Chart -->
  <div class="card">
    <h2>Grade Distribution by Category</h2>
    <div class="chart-container">
      <canvas id="gradeDistChart"></canvas>
    </div>
  </div>

  <!-- Curve Impact -->
  <div class="card">
    <h2>Curve Impact: Students Moving Up a Grade</h2>
    <div class="chart-container">
      <canvas id="curveImpactChart"></canvas>
    </div>
  </div>

  <!-- Dot Strip Plot - RR1 -->
  <div class="card">
    <h2>RR1 Individual Scores (Anonymous)</h2>
    <div class="chart-container">
      <canvas id="rr1DotChart"></canvas>
    </div>
  </div>

  <!-- Dot Strip Plot - RR2 -->
  <div class="card">
    <h2>RR2 Individual Scores (Anonymous)</h2>
    <div class="chart-container">
      <canvas id="rr2DotChart"></canvas>
    </div>
  </div>

  <!-- Overall Distribution -->
  <div class="card full">
    <h2>Combined Score Distribution (Both RRs, n=36)</h2>
    <div class="chart-container tall">
      <canvas id="histogramChart"></canvas>
    </div>
  </div>

  <!-- Detailed Table -->
  <div class="card full">
    <h2>Detailed Breakdown</h2>
    <table>
      <thead>
        <tr>
          <th></th>
          <th class="num">RR1 Pre</th>
          <th class="num">RR1 Post</th>
          <th class="num">RR2 Pre</th>
          <th class="num">RR2 Post</th>
          <th class="num">Overall Pre</th>
          <th class="num">Overall Post</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>A (85-100)</td>
          <td class="num">6</td>
          <td class="num highlight">12</td>
          <td class="num">3</td>
          <td class="num highlight">6</td>
          <td class="num">9</td>
          <td class="num highlight">18</td>
        </tr>
        <tr>
          <td>B (70-84)</td>
          <td class="num">7</td>
          <td class="num">3</td>
          <td class="num">6</td>
          <td class="num">7</td>
          <td class="num">13</td>
          <td class="num">10</td>
        </tr>
        <tr>
          <td>C (50-69)</td>
          <td class="num">5</td>
          <td class="num">3</td>
          <td class="num">5</td>
          <td class="num">5</td>
          <td class="num">10</td>
          <td class="num">8</td>
        </tr>
        <tr>
          <td>D/F (0-49)</td>
          <td class="num">0</td>
          <td class="num">0</td>
          <td class="num">4</td>
          <td class="num highlight">0</td>
          <td class="num">4</td>
          <td class="num highlight">0</td>
        </tr>
        <tr style="border-top: 2px solid #334155;">
          <td><strong>Average</strong></td>
          <td class="num"><strong>77.2</strong></td>
          <td class="num highlight"><strong>86.5</strong></td>
          <td class="num"><strong>69.0</strong></td>
          <td class="num highlight"><strong>79.7</strong></td>
          <td class="num"><strong>73.1</strong></td>
          <td class="num highlight"><strong>83.1</strong></td>
        </tr>
        <tr>
          <td>Median</td>
          <td class="num">77.5</td>
          <td class="num">87.5</td>
          <td class="num">72.5</td>
          <td class="num">80.5</td>
          <td class="num">73.5</td>
          <td class="num">84.5</td>
        </tr>
        <tr>
          <td>Min</td>
          <td class="num">51</td>
          <td class="num highlight">61</td>
          <td class="num">40</td>
          <td class="num highlight">60</td>
          <td class="num">40</td>
          <td class="num highlight">60</td>
        </tr>
        <tr>
          <td>Max</td>
          <td class="num">95</td>
          <td class="num">100</td>
          <td class="num">96</td>
          <td class="num">100</td>
          <td class="num">96</td>
          <td class="num">100</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<script>
// ── Data ──
// Pre-curve = bonus-adjusted scores (what students currently have)
// Post-curve = +10 flat curve, floor 60, cap 100
const rr1Pre  = [94,94,51,82,57,90,67,79,68,74,86,56,75,76,88,95,82,76];
const rr1Post = [100,100,61,92,67,100,77,89,78,84,96,66,85,86,98,100,92,86];
const rr2Pre  = [94,96,42,49,69,60,84,68,82,53,84,72,40,46,73,68,89,73];
const rr2Post = [100,100,60,60,79,70,94,78,92,63,94,82,60,60,83,78,99,83];

function countGrades(scores) {
  const a = scores.filter(s => s >= 85).length;
  const b = scores.filter(s => s >= 70 && s < 85).length;
  const c = scores.filter(s => s >= 50 && s < 70).length;
  const d = scores.filter(s => s < 50).length;
  return [a, b, c, d];
}

const cats = ['A (85-100)', 'B (70-84)', 'C (50-69)', 'D/F (0-49)'];

// Chart defaults
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = '#334155';
Chart.defaults.font.family = "'Segoe UI', system-ui, sans-serif";

// ── 1. Grade Distribution Grouped Bar ──
new Chart(document.getElementById('gradeDistChart'), {
  type: 'bar',
  data: {
    labels: cats,
    datasets: [
      { label: 'RR1 Pre', data: countGrades(rr1Pre), backgroundColor: '#3b82f680', borderColor: '#3b82f6', borderWidth: 1 },
      { label: 'RR1 Post', data: countGrades(rr1Post), backgroundColor: '#60a5fa80', borderColor: '#60a5fa', borderWidth: 1 },
      { label: 'RR2 Pre', data: countGrades(rr2Pre), backgroundColor: '#be185d80', borderColor: '#be185d', borderWidth: 1 },
      { label: 'RR2 Post', data: countGrades(rr2Post), backgroundColor: '#f472b680', borderColor: '#f472b6', borderWidth: 1 },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom', labels: { boxWidth: 12, padding: 15, font: { size: 11 } } }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { stepSize: 2 },
        title: { display: true, text: 'Number of Students', font: { size: 11 } }
      }
    }
  }
});

// ── 2. Curve Impact ──
function gradeCategory(score) {
  if (score >= 85) return 'A';
  if (score >= 70) return 'B';
  if (score >= 50) return 'C';
  return 'D/F';
}

let rr1MovedUp = 0, rr1Same = 0;
let rr2MovedUp = 0, rr2Same = 0;

for (let i = 0; i < 18; i++) {
  if (gradeCategory(rr1Post[i]) !== gradeCategory(rr1Pre[i])) rr1MovedUp++;
  else rr1Same++;
  if (gradeCategory(rr2Post[i]) !== gradeCategory(rr2Pre[i])) rr2MovedUp++;
  else rr2Same++;
}

new Chart(document.getElementById('curveImpactChart'), {
  type: 'bar',
  data: {
    labels: ['RR1', 'RR2'],
    datasets: [
      {
        label: 'Moved up a grade',
        data: [rr1MovedUp, rr2MovedUp],
        backgroundColor: '#34d39990',
        borderColor: '#34d399',
        borderWidth: 1
      },
      {
        label: 'Same grade (still boosted)',
        data: [rr1Same, rr2Same],
        backgroundColor: '#fbbf2480',
        borderColor: '#fbbf24',
        borderWidth: 1
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom', labels: { boxWidth: 12, padding: 15, font: { size: 11 } } },
      tooltip: {
        callbacks: {
          afterBody: function(ctx) {
            const idx = ctx[0].dataIndex;
            const pre = idx === 0 ? rr1Pre : rr2Pre;
            const post = idx === 0 ? rr1Post : rr2Post;
            const avgBoost = (post.reduce((a,b) => a+b, 0) - pre.reduce((a,b) => a+b, 0)) / 18;
            return `\nAll 18 students received curve\nAvg boost: +${avgBoost.toFixed(1)} pts`;
          }
        }
      }
    },
    scales: {
      x: { stacked: true },
      y: {
        stacked: true,
        beginAtZero: true,
        ticks: { stepSize: 2 },
        title: { display: true, text: 'Number of Students', font: { size: 11 } }
      }
    }
  }
});

// ── 3 & 4. Dot Strip Plots (stacked: pre-curve base + curve boost) ──
function makeDotChart(canvasId, pre, post, baseColor, label) {
  const sorted = pre.map((p, i) => ({ pre: p, post: post[i], boost: post[i] - p }))
    .sort((a, b) => a.pre - b.pre);

  const labels = sorted.map((_, i) => `S${i + 1}`);

  new Chart(document.getElementById(canvasId), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Pre-Curve',
          data: sorted.map(s => s.pre),
          backgroundColor: baseColor + '90',
          borderColor: baseColor,
          borderWidth: 1,
          borderRadius: 2,
        },
        {
          label: 'Curve Boost',
          data: sorted.map(s => s.boost),
          backgroundColor: '#34d39990',
          borderColor: '#34d399',
          borderWidth: 1,
          borderRadius: { topLeft: 2, topRight: 2 },
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom', labels: { boxWidth: 12, padding: 15, font: { size: 11 } } },
        tooltip: {
          callbacks: {
            label: function(ctx) {
              const i = ctx.dataIndex;
              if (ctx.datasetIndex === 0) return `Pre-Curve: ${sorted[i].pre}`;
              return `Curve: +${sorted[i].boost} → ${sorted[i].post}`;
            }
          }
        }
      },
      scales: {
        x: {
          stacked: true,
          ticks: { font: { size: 9 } }
        },
        y: {
          stacked: true,
          min: 30,
          max: 105,
          ticks: { stepSize: 10 },
          title: { display: true, text: 'Score', font: { size: 11 } }
        }
      }
    }
  });
}

makeDotChart('rr1DotChart', rr1Pre, rr1Post, '#3b82f6', 'RR1');
makeDotChart('rr2DotChart', rr2Pre, rr2Post, '#be185d', 'RR2');

// ── 5. Combined Histogram ──
function buildHistBins(scores, binSize) {
  const bins = {};
  for (let start = 30; start <= 100; start += binSize) {
    bins[start] = 0;
  }
  scores.forEach(s => {
    const bin = Math.floor(s / binSize) * binSize;
    const key = Math.max(30, Math.min(bin, 100));
    bins[key] = (bins[key] || 0) + 1;
  });
  return bins;
}

const binSize = 5;
const binLabels = [];
for (let s = 30; s <= 100; s += binSize) {
  binLabels.push(`${s}-${Math.min(s + binSize - 1, 100)}`);
}

const allPre = [...rr1Pre, ...rr2Pre];
const allPost = [...rr1Post, ...rr2Post];
const preBins = buildHistBins(allPre, binSize);
const postBins = buildHistBins(allPost, binSize);

new Chart(document.getElementById('histogramChart'), {
  type: 'bar',
  data: {
    labels: binLabels,
    datasets: [
      {
        label: 'Pre-Curve',
        data: Object.values(preBins),
        backgroundColor: '#64748b80',
        borderColor: '#64748b',
        borderWidth: 1,
        borderRadius: 2,
      },
      {
        label: 'Post-Curve',
        data: Object.values(postBins),
        backgroundColor: '#34d39960',
        borderColor: '#34d399',
        borderWidth: 1,
        borderRadius: 2,
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom', labels: { boxWidth: 12, padding: 15, font: { size: 11 } } }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { stepSize: 1 },
        title: { display: true, text: 'Number of Submissions', font: { size: 11 } }
      },
      x: {
        title: { display: true, text: 'Score Range', font: { size: 11 } },
        ticks: { font: { size: 10 } }
      }
    }
  }
});
</script>

</body>
</html>
